<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hardware, IP & Location Information</title>
</head>
<body>
    <h1>Hardware, IP & Location Information</h1>

    <div id="hardware-info">
        <p>Loading hardware and environment information...</p>
    </div>
    <div id="ip-info">
        <p>Loading IP and location information...</p>
    </div>

    <script>
        // Функция для получения локального IP через WebRTC
        async function getLocalIP() {
            return new Promise((resolve, reject) => {
                const peerConnection = new RTCPeerConnection();
                peerConnection.createDataChannel('');
                peerConnection.createOffer().then(offer => peerConnection.setLocalDescription(offer));

                peerConnection.onicecandidate = (event) => {
                    if (event && event.candidate && event.candidate.candidate) {
                        const candidate = event.candidate.candidate;
                        const ipMatch = candidate.match(/(\d{1,3}(\.\d{1,3}){3})/); // Регулярное выражение для извлечения IP
                        if (ipMatch) {
                            resolve(ipMatch[1]);
                            peerConnection.close();
                        }
                    }
                };

                setTimeout(() => reject('Failed to retrieve IP address'), 1000);
            });
        }

        // Функция для получения геолокации
        function getGeolocation() {
            return new Promise((resolve, reject) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const { latitude, longitude } = position.coords;
                            resolve({ latitude, longitude });
                        },
                        (error) => {
                            reject(error.message);
                        }
                    );
                } else {
                    reject('Geolocation is not supported by this browser.');
                }
            });
        }

        // Функция для получения публичного IP через сервер
        async function getPublicIP() {
            return new Promise((resolve, reject) => {
                fetch('/get-ip')  // Ваш серверный маршрут для получения IP
                    .then(response => response.json())
                    .then(data => resolve(data.ip))
                    .catch(err => reject('Error fetching public IP: ' + err));
            });
        }

        // Основная функция для сбора данных
        async function detectHardwareAndLocation() {
            const ipInfoDiv = document.getElementById("ip-info");
            const infoDiv = document.getElementById("hardware-info");

            try {
                // Получаем данные о публичном IP через сервер
                const publicIP = await getPublicIP();
                
                // Получаем локальный IP через WebRTC
                const localIP = await getLocalIP();
                
                // Получаем геолокацию
                const location = await getGeolocation();

                // Информация о аппаратных данных
                const logicalProcessors = navigator.hardwareConcurrency || 'Unknown';
                const memory = navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'Unknown';
                const platform = navigator.platform || 'Unknown';
                const userAgent = navigator.userAgent || 'Unknown';

                // Разрешение и экран
                const screenWidth = window.screen.width || 'Unknown';
                const screenHeight = window.screen.height || 'Unknown';
                const colorDepth = window.screen.colorDepth || 'Unknown';
                const pixelRatio = window.devicePixelRatio || 'Unknown';
                const orientation = screen.orientation ? screen.orientation.type : 'Unknown';

                // Время и часовой пояс
                const localTime = new Date().toLocaleString();
                const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const timeOffset = new Date().getTimezoneOffset();

                // Информация о GPU
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                let gpuInfo = 'Unknown', gpuVendor = 'Unknown';
                if (gl) {
                    const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                    gpuVendor = debugInfo ? gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) : 'Unavailable';
                    gpuInfo = debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'Unavailable';
                }

                // Подготовка вывода
                infoDiv.innerHTML = `
                    <h2>Hardware Information</h2>
                    <p><strong>Platform:</strong> ${platform}</p>
                    <p><strong>User Agent:</strong> ${userAgent}</p>
                    <p><strong>Logical Processors:</strong> ${logicalProcessors}</p>
                    <p><strong>Memory:</strong> ${memory}</p>
                    <p><strong>GPU Vendor:</strong> ${gpuVendor}</p>
                    <p><strong>GPU Renderer:</strong> ${gpuInfo}</p>
                    
                    <h2>Screen Information</h2>
                    <p><strong>Resolution:</strong> ${screenWidth} x ${screenHeight}</p>
                    <p><strong>Color Depth:</strong> ${colorDepth}-bit</p>
                    <p><strong>Pixel Ratio:</strong> ${pixelRatio}</p>
                    <p><strong>Orientation:</strong> ${orientation}</p>
                    
                    <h2>Time Information</h2>
                    <p><strong>Local Time:</strong> ${localTime}</p>
                    <p><strong>Time Zone:</strong> ${timeZone}</p>
                    <p><strong>Time Offset:</strong> ${timeOffset} minutes</p>
                `;

                // Данные о местоположении
                ipInfoDiv.innerHTML = `
                    <h2>IP and Location Information</h2>
                    <p><strong>Public IP Address:</strong> ${publicIP}</p>
                    <p><strong>Local IP Address:</strong> ${localIP}</p>
                    <p><strong>Latitude:</strong> ${location.latitude}</p>
                    <p><strong>Longitude:</strong> ${location.longitude}</p>
                `;
            } catch (error) {
                ipInfoDiv.textContent = `Error: ${error}`;
                infoDiv.textContent = `Error: ${error}`;
            }
        }

        detectHardwareAndLocation();
    </script>
</body>
</html>
